/* global Document, Exporter */
"use strict";

/**
 * DocumentController
 *
 * @description :: Server-side logic for managing Documents
 * @help        :: See http://sailsjs.org/#!/documentation/concepts/Controllers
 */

module.exports = {
    synchronizeDraft: async function (req, res) {
        const draftId = req.params.draftId;
        const draft = await Document.findOneById(draftId);
        const synchronized = req.body.synchronized;
        res.halt(draft.scopusSynchronize(synchronized));
    },
    desynchronizeDrafts: async function (req, res) {
        const drafts = req.body.drafts;
        res.halt(Document.desynchronizeAll(drafts));
    },
    externalSearch: async function (req, res) {
        const origin = req.query.origin;
        const searchKey = req.query.searchKey;
        const searchValue = req.query.searchValue;
        res.halt(Document.externalSearch(origin, searchKey, searchValue));
    },
    async export(req, res) {
        const documentIds = Array.isArray(req.body.documentIds) ? req.body.documentIds : [req.body.documentIds];
        const format = req.body.format;

        Exporter.exportDownload(Document, res, documentIds, format);
    }
};

